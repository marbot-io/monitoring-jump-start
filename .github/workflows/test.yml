name: Test

on:
  push:
    branches:
    - master
  pull_request: {}

jobs:
  test:
    runs-on: 'ubuntu-18.04'

    steps:
    - name: 'Set up Python 2.7'
      uses: actions/setup-python@v2
      with:
        python-version: '2.7'

    - uses: 'actions/checkout@v2'

    - name: Script
      run: |
        python -m pip install --upgrade pip
        pip install yamllint==1.23.0
        pip install cfn-lint==0.33.0
        yamllint .
        find . -type f \( -name '*.yml' -o -name '*.yaml' \) -a ! -name '.*' | while read file; do set -ex && cfn-lint --template "$file"; done;
        find . -type f \( -name '*.yml' -o -name '*.yaml' \) -a ! -name '.*' | while read file; do set -ex && grep -q "LICENSE-2.0" "$file"; done;
